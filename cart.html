---
layout: default
title: Carrito
---

<script>
let CURRENT_ORDER_ID = null;

function getOrderID() {
  if (!CURRENT_ORDER_ID) {
    CURRENT_ORDER_ID = generateOrderID();
  }
  return CURRENT_ORDER_ID;
}
</script>

<h1>Carrito de Compras</h1>

<div id="cart"></div>

<h3>Total: <span id="total"></span></h3>
<div class="cart-actions">
<button onclick="sendWhatsApp()">Enviar por WhatsApp</button>
<button onclick="sendSMS()">Enviar por SMS</button>
<button onclick="sendEmail()">Enviar por Email</button>
</div>
<button onclick="window.print()">Imprimir Pedido</button>

<script src="/assets/js/cart.js"></script>
<script>
function renderCart() {
  const cart = loadCart();
  const el = document.getElementById("cart");
  el.innerHTML = "";

  if (!cart.items.length) {
    el.innerHTML = "<p>El carrito est√° vac√≠o.</p>";
    return;
  }

  cart.items.forEach(i => {
    el.innerHTML += `
      <div class="cart-item">
        <strong>${i.name}</strong><br>
        ${formatQ(i.price)}<br>
        <button onclick="changeQty('${i.sku}', -1)">‚àí</button>
        ${i.qty}
        <button onclick="changeQty('${i.sku}', 1)">+</button>
      </div>
    `;
  });

  document.getElementById("total").innerText = formatQ(cartTotal());
}

document.addEventListener("DOMContentLoaded", renderCart);


// Order Message Builder (Critical) This ensures consistent, readable orders across WhatsApp, SMS, and Email.
function buildOrderMessage() {
  const cart = loadCart();
  const orderId = getOrderID();


  let msg = `üõí *Nuevo Pedido*\n`;
  msg += `Orden: ${orderId}\n\n`;

  cart.items.forEach(i => {
    msg += `‚Ä¢ ${i.name}\n  Cantidad: ${i.qty}\n  Precio: ${formatQ(i.price)}\n\n`;
  });

  msg += `TOTAL: ${formatQ(cartTotal())}\n`;
  msg += `Pago: Contra entrega\n`;
  msg += `Contacto posterior para direcci√≥n.\n`;

  return { text: encodeURIComponent(msg), orderId };
}

//Order ID Generation, Simple, readable, unique-enough for COD operations
function generateOrderID() {
  const d = new Date();
  return (
    "MG-" +
    d.getFullYear().toString().slice(-2) +
    (d.getMonth() + 1).toString().padStart(2, "0") +
    d.getDate().toString().padStart(2, "0") +
    "-" +
    Math.floor(1000 + Math.random() * 9000)
  );
}
//Send Actions + Auto-Clear After Send
function finalizeOrder() {
  clearCart();
  alert("Pedido enviado. Nos comunicaremos pronto.");
}

function sendWhatsApp() {
  const o = buildOrderMessage();
  window.location.href =
    "https://wa.me/50259655375?text=" + o.text;
  setTimeout(finalizeOrder, 1500);

}

function sendSMS() {
  const o = buildOrderMessage();
  window.location.href =
    "sms:+50259655375?body=" + o.text;
  setTimeout(finalizeOrder, 1500);

}

function sendEmail() {
  const o = buildOrderMessage();
  window.location.href =
    "mailto:help@myguate.com?subject=Nuevo Pedido " + o.orderId +
    "&body=" + o.text;
  setTimeout(finalizeOrder, 1500);

}

</script>
